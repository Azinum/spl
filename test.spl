// test.spl

fn write(fd, buf, count) { let _ syscall3(1, fd, buf, count); }

fn putc(fd, ch) {
  write(fd, @ch, 1);
}

fn puts(fd, str) {
  while neq 0 load8 str {
    putc(fd, load8 str);
    = @str +1 str;
  }
}

fn memset(ptr, c, n) {
  let count 0;
  while < count n {
    store8 ptr c; = @ptr +1 ptr;
    = @count +1 count;
  }
}

fn strlen(str) {
  let length 0;
  while < 0 load8 str {
    = @length +1 length;
    = @str +1 str;
  }
  length;
}

fn add(a, b) + a b;

fn main {
  let str "Hello, World\n";
  let stdout 1;
  let length strlen(str);
  print length;
  memset(str, 97, - length 1);
  puts(stdout, str);
}
